(function(a,e){var d=function(a,d,e){var k;return function(){var l=this,m=arguments;k?clearTimeout(k):e&&a.apply(l,m);k=setTimeout(function(){e||a.apply(l,m);k=null},d||100)}};jQuery.fn[e]=function(a){return a?this.bind("resize",d(a)):this.trigger(e)}})(jQuery,"smartresize");
(function(a){a.fn.fluidbox=function(e){var d=a.extend(!0,{viewportFill:.95,overlayColor:"rgba(255,255,255,.85)",debounceResize:!0,stackIndex:1E3,stackIndexDelta:10,closeTrigger:[{selector:".fluidbox-overlay",event:"click"},{selector:"document",event:"keyup",keyCode:27}]},e);d.stackIndex<d.stackIndexDelta&&(d.stackIndexDelta=d.stackIndex);$fbOverlay=a("<div />",{"class":"fluidbox-overlay",css:{"background-color":d.overlayColor,"z-index":d.stackIndex}});var n=this,f=a(window),p,k=function(){a(".fluidbox-opened").trigger("click")},
l=function(a){var b=a.find("img"),c=a.find(".fluidbox-ghost"),e=a.find(".fluidbox-wrap");a=a.data();var g=0,g=0;p>b.data().imgRatio?(g=a.natHeight<f.height()*d.viewportFill?a.natHeight:f.height()*d.viewportFill,a.imgScale=g/b.height()):(g=a.natWidth<f.width()*d.viewportFill?a.natWidth:f.width()*d.viewportFill,a.imgScale=g/b.width());var g=f.scrollTop()-b.offset().top+.5*b.data("imgHeight")*(b.data("imgScale")-1)+.5*(f.height()-b.data("imgHeight")*b.data("imgScale")),h=.5*b.data("imgWidth")*(b.data("imgScale")-
1)+.5*(f.width()-b.data("imgWidth")*b.data("imgScale"))-b.offset().left;a=a.imgScale;c.css({transform:"translate("+parseInt(10*h)/10+"px,"+parseInt(10*g)/10+"px) scale("+parseInt(1E3*a)/1E3+")",top:b.offset().top-e.offset().top,left:b.offset().left-e.offset().left})},m=function(){n.each(function(){q(a(this))})},q=function(a){p=f.width()/f.height();if(a.hasClass("fluidbox")){var b=function(){h.imgWidth=c.width();h.imgHeight=c.height();h.imgRatio=c.width()/c.height();e.css({width:c.width(),height:c.height(),
top:c.offset().top-g.offset().top+parseInt(c.css("borderTopWidth"))+parseInt(c.css("paddingTop")),left:c.offset().left-g.offset().left+parseInt(c.css("borderLeftWidth"))+parseInt(c.css("paddingLeft"))});h.imgScale=p>h.imgRatio?f.height()*d.viewportFill/c.height():f.width()*d.viewportFill/c.width()},c=a.find("img"),e=a.find(".fluidbox-ghost"),g=a.find(".fluidbox-wrap"),h=c.data();b();c.load(b)}},r=function(e){if(a(this).hasClass("fluidbox")){var b=a(this),c=a(this).find("img"),f=a(this).find(".fluidbox-ghost"),
g=a(this).find(".fluidbox-wrap"),h={};0!==a(this).data("fluidbox-state")&&a(this).data("fluidbox-state")?(b.data("fluidbox-state",0).removeClass("fluidbox-opened").addClass("fluidbox-closed"),h.open&&window.clearTimeout(h.open),h.close=window.setTimeout(function(){a(".fluidbox-overlay").remove();g.css({"z-index":d.stackIndex-d.stackIndexDelta})},10),a(".fluidbox-overlay").css({opacity:0}),f.css({transform:"translate(0,0) scale(1)",opacity:0,top:c.offset().top-g.offset().top+parseInt(c.css("borderTopWidth"))+
parseInt(c.css("paddingTop")),left:c.offset().left-g.offset().left+parseInt(c.css("borderLeftWidth"))+parseInt(c.css("paddingLeft"))}),c.css({opacity:1})):a("<img />",{src:c.attr("src")}).load(function(){a("<img />",{src:b.attr("href")}).load(function(){b.data("natWidth",a(this)[0].naturalWidth).data("natHeight",a(this)[0].naturalHeight);b.append($fbOverlay).data("fluidbox-state",1).removeClass("fluidbox-closed").addClass("fluidbox-opened");h.close&&window.clearTimeout(h.close);h.open=window.setTimeout(function(){a(".fluidbox-overlay").css({opacity:1})},
10);a(".fluidbox-wrap").css({zIndex:d.stackIndex-d.stackIndexDelta-1});g.css({"z-index":d.stackIndex+d.stackIndexDelta});f.css({"background-image":"url("+c.attr("src")+")",opacity:1});c.css({opacity:0});f.css({"background-image":"url("+b.attr("href")+")"});l(b)})});e.preventDefault()}};d.closeTrigger&&a.each(d.closeTrigger,function(e){var b=d.closeTrigger[e];if("window"!=b.selector)if("document"==b.selector)if(b.keyCode)a(document).on(b.event,function(a){a.keyCode==b.keyCode&&k()});else a(document).on(b.event,
k);else a(document).on(b.event,d.closeTrigger[e].selector,k);else f.on(b.event,k)});n.each(function(e){if(a(this).is("a")&&1===a(this).children().length&&a(this).children().is("img")&&"none"!==a(this).css("display")&&"none"!==a(this).parents().css("display")){e=a("<div />",{"class":"fluidbox-wrap",css:{"z-index":d.stackIndex-d.stackIndexDelta}});var b=a(this);b.addClass("fluidbox").wrapInner(e).find("img").css({opacity:1}).after('<div class="fluidbox-ghost" />').each(function(){var c=a(this);0<c.width()&&
0<c.height()?(q(b),b.click(r)):c.load(function(){q(b);b.click(r)})})}});e=function(){m();var d=a("a.fluidbox.fluidbox-opened");0<d.length&&l(d)};d.debounceResize?a(window).smartresize(e):a(window).resize(e);return n}})(jQuery);jQuery(document).ready(function(){jQuery("a[href$='.jpg'],a[href$='.png'],a[href$='.gif'],a[href$='.jpeg']").fluidbox()});